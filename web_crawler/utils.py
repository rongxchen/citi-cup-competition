import random
import requests
import time
from my_fake_useragent import UserAgent
import hashlib


def get_random_ua():
    """ get random user-agent
    :return: random user-agent
    """
    user_agent = UserAgent(family="chrome")
    return user_agent.random()


hk_ip = [
    {"http": "123.202.159.203:80"},
    {"http": "118.140.172.77:8888"},
    {"http": "203.176.221.40:80"},
    {"http": "218.250.67.85:80"},
    {"http": "42.98.75.138:80"},
    {"http": "58.153.12.105:80"},
    {"http": "43.251.135.19:8080"},
    {"http": "103.234.55.173:80"},
    {"http": "113.254.5.203:80"},
    {"http": "223.19.151.121:80"},
    {"http": "116.49.163.71:80"},
    {"http": "47.90.126.138:9090"},

    # international ips
    {"http": "18.166.102.214:3128"},
    {"http": "201.71.2.151:999"},
    {"http": "45.70.236.123:999"},
    {"http": "103.241.178.145:8080"},
    {"http": "195.88.148.18:3128"},
    {"http": "191.97.14.26:999"},
    {"http": "183.223.24.122:9091"},
    {"http": "61.28.224.211:3128"},
    {"http": "103.241.182.97:80"},
    {"http": "103.57.225.240:8080"},
]

ips = ['178.33.3.163:8080', '80.252.5.34:7001', '116.98.180.150:10003', '31.186.239.246:8080',
       '198.59.191.234:8080', '158.51.121.230:8881', '201.17.26.54:80', '116.98.176.225:10003',
       '154.236.179.226:1981', '1.214.62.71:8000', '157.245.27.9:3128', '4.144.128.48:80',
       '174.70.1.210:8080', '125.17.80.226:8080', '116.98.183.158:10003', '51.68.97.175:7890',
       '179.96.28.58:80', '5.78.50.231:8888', '64.92.82.61:8080', '31.186.239.244:8080',
       '115.144.102.39:10080', '146.59.127.168:80', '185.73.202.85:80', '82.165.184.53:80',
       '173.255.240.80:80', '132.147.34.22:8111', '201.238.248.139:9229', '200.105.215.22:33630',
       '198.27.74.6:9300', '64.225.4.17:9979', '130.41.109.158:8080', '111.225.152.181:8089',
       '116.111.133.135:4002', '65.108.69.40:10046', '193.201.228.121:80', '116.98.177.99:10003',
       '201.229.250.21:8080', '158.69.52.218:9300', '65.18.114.254:55443', '149.56.96.252:9300',
       '181.129.70.82:46752', '103.156.219.33:55443', '118.27.113.167:8080', '165.246.148.50:8088',
       '185.246.84.7:8080', '102.130.192.231:8080', '116.98.190.215:10003', '5.189.184.6:80',
       '4.16.68.158:443', '104.223.135.178:10000', '65.108.230.239:42899', '51.79.50.22:9300',
       '8.219.97.248:80', '103.121.149.69:8080', '124.197.37.13:8080', '154.236.189.30:8080',
       '190.61.88.147:8080', '116.98.229.237:10003', '116.98.181.242:10003', '41.65.236.43:1976',
       '103.94.123.210:80', '185.97.114.251:3128', '61.178.141.146:80', '165.227.81.188:9958',
       '192.145.183.22:8080', '111.225.152.2:8089', '24.172.82.94:53281', '188.0.147.102:3128',
       '167.71.199.211:39909', '113.161.114.2:3128', '81.89.220.11:3128', '181.205.86.66:80',
       '20.241.236.196:3128', '41.33.219.141:8080', '185.81.23.138:3128', '130.41.228.81:8080',
       '8.209.240.66:2080', '181.45.148.40:80', '5.58.110.249:8080', '45.61.187.67:4007',
       '3.134.56.120:80', '119.8.236.97:3128', '146.158.19.130:8080', '93.91.112.247:41258',
       '103.141.109.237:8080', '167.250.47.187:8080', '195.182.152.238:38178', '190.210.62.131:8080',
       '144.22.249.38:80', '65.108.230.238:45977', '116.98.188.44:10003', '43.243.142.60:59916',
       '125.166.59.91:80', '158.69.72.138:9300', '113.174.233.116:4001', '213.222.34.200:53281',
       '180.94.69.66:8080', '188.158.120.127:8080', '198.11.175.180:8080', '47.252.27.174:8081']


def get_random_proxy():
    """ get random proxy
    :return: a random ip proxy
    """
    rand = random.randint(0, len(ips)-1)
    # return {"http": ips[rand]}
    return {}


def sign_for_Youdao(sentence):
    """ encryption method used by neatease translation website
    :param sentence: input sentence for translation
    :return: md5 hex digest
    """
    md = hashlib.md5()
    salt = str(time.time() * 1000) + str(random.randint(0, 9))
    s = "fanyideskweb"
    n = sentence
    r = salt
    d = "Y2FYu%TNSbMCxc3t2u^XT"
    val = s + n + r + d
    md.update(val.encode())
    return md.hexdigest()


def youdao_translator(sentence):
    """ translate CHIN sentence(s) into ENG sentence(s)
    :param sentence: input sentence(s) for translation
    :return: translated sentence(s)
    """
    url = "https://dict.youdao.com/jsonapi_s?doctype=json&jsonversion=4"
    headers = {"user-agent": get_random_ua()}
    proxies = get_random_proxy()
    data = {
        "q": sentence,
        "le": "en",
        "t": "",  # not necessary
        "client": "web",
        # using md5 to encipher 4 variables (s, n, r, d)
        # where s = client, n = input word(s), r = salt(timestamp+randint(0, 9)), d = fix string
        "sign": sign_for_Youdao(sentence),
        "keyfrom": "webdict"
    }
    try:
        resp = requests.post(url=url, headers=headers, data=data, proxies=proxies)
        data = resp.json()["fanyi"]["tran"]
        return data
    except Exception as e:
        print(f"exception: {e}")
        print("error occurred in Youdao Translation Process")
    return ""
